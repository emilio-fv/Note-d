<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Note-d | Search Music</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar mx-3">
        <div class="navbar-menu" role="navigation" aria-label="main navigation">
            <div class="navbar-brand">
                <a href="/dashboard" class="navbar-item is-size-3">Note-d</a>
            </div>
            <div class="navbar-start mt-2 ml-4">
                <a href="/dashboard" class="navbar-item">Home</a>
                <a href="/users/music/search_form" class="navbar-item">Search Music</a>
                <a href="/users/user_search" class="navbar-item">Search Users</a>
                <!-- <a href="/reviews/new" class="navbar-item">Create Review</a> -->
            </div>
            <div class="navbar-end">
                <!-- <div class="navbar-item">
                    <a href="#" class="navbar-item">Profile</a>
                </div> -->
                <div class="navbar-item">
                    <a href="/users/logout" class="navbar-item button is-danger">Logout</a>
                </div>
            </div>
        </div>
    </nav>
    <!-- Music Search Form -->
    <div class="container mt-6">
        <h1 class="has-text-centered is-size-3 mb-3">Search Music</h1>
        <!-- TODO: Form data processing -->
        <form id="search_albums_form" onsubmit="SearchByAlbum(event)">
            <div class="is-flex-direction-row is-justify-content-center field has-addons">
                <div class="control mb-4">
                  <input class="input" type="text" name="album_name" id="album_name" placeholder="Search by album...">
                </div>
                <div class="control mb-4">
                  <button class="button is-info">Search</button>
                </div>
              </div>
        </form>
        <!-- Album Tiles -->
        <div class="mt-5">
            <div class="tile is-ancestor" >
                <div class="tile is-parent" id="album_results">
                </div>
            </div>
        </div>
    </div>
</body>
<script>
console.log("Script attached good to go")
function SearchByAlbum(event) {
    event.preventDefault() // Prevent refreshing of the page when form submitted
    console.log("Submitted")
    var search_albums_form = document.getElementById('search_albums_form') // Initialize var for the search by album form
    var album_results_div = document.querySelector('#album_results')
    var form = new FormData(search_albums_form);
    fetch("http://127.0.0.1:5000/users/music/search", { method: 'POST', body: form})
    .then( response => response.json() )
    .then( data => {
        // console.log(data)
        // data[x]['album_name'] 
        // data[x]['album_artist'] 
        for (x in data) {
                console.log(data[x]['album_name'])
                var newElement = document.createElement("article");
                newElement.innerHTML = `
                        <p class="title mb-6 has-text-centered"><a href="/users/music/view/${data[x]['album_id']}">${data[x]['album_name']}</a></p>
                        <p class="subtitle has-text-centered">${data[x]['album_artist']}</p>
                `
                console.log(newElement)
                newElement.setAttribute("class","tile is-child box")
                album_results_div.appendChild(newElement);
            }
        })
        .catch(err => console.log(err))
}




    // <article class="tile is-child box">
    //     <p class="title"><a href="/music/view"></a></p>
    //     <p class="subtitle"></p>
    // </article>
</script>
</html>